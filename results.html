<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blendvertise Results</title>
    <link href="https://fonts.googleapis.com/css2?display=swap&family=Wix+Madefor+Text:ital,wght@0,800;1,800&family=Inter:ital,wght@0,300;1,300&family=Work+Sans:ital,wght@0,500;0,600;1,500;1,600" rel="stylesheet" type="text/css" />
    <style>
        :root {
            --background-height: 100vh;
            --viewport-height: 100vh;
        }

        body {
            font-family: 'Inter', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #FFFFFF;
            line-height: 1.0;
            min-height: var(--viewport-height);
            min-width: 320px;
            overflow-x: hidden;
            word-wrap: break-word;
        }

        body:before {
            background-attachment: scroll;
            content: '';
            display: block;
            height: var(--background-height);
            left: 0;
            pointer-events: none;
            position: fixed;
            top: 0;
            transform: scale(1);
            width: 100vw;
            z-index: 0;
            background-image: radial-gradient(circle, rgba(191,191,191,0.502) 1.5px, transparent 1.5px);
            background-size: 24px 24px;
            background-position: center;
            background-repeat: repeat;
            opacity: 0.5;
        }

        .content-wrapper {
            position: relative;
            z-index: 2;
            padding-bottom: 120px; /* Space for FAB buttons */
        }

        h1, h2 {
            font-family: 'Wix Madefor Text', sans-serif;
            color: #47403E;
            font-weight: 800;
            line-height: 1.125;
        }

        .logo-image {
            width: 195px; /* Increased by 30% from 150px */
            height: auto;
        }

        .content-box {
            background-color: #FDE6E8;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .stats {
            background-color: #F69BA4;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            color: #47403E;
            font-family: 'Inter', sans-serif;
            font-weight: 300;
            line-height: 1.4;
        }

        /* Added markdown styles for stats description */
        .stats p {
            margin: 0.5em 0;
        }

        .stats strong {
            font-weight: 600;
        }

        .stats em {
            font-style: italic;
        }

        .stats a {
            color: #47403E;
            text-decoration: underline;
        }

        .highlight {
            background-color: #F89AA6;
        }

        .banner {
            display: flex;
            justify-content: space-between;
            background-color: #FFF0F0;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .banner-item {
            flex: 1;
            text-align: center;
            padding: 0 10px;
            font-family: 'Inter', sans-serif;
        }

        .banner-item:not(:last-child) {
            border-right: 1px solid #FFD6D6;
        }

        .banner-item h3 {
            margin: 0 0 10px 0;
            color: #FF6B6B;
            font-family: 'Wix Madefor Text', sans-serif;
            font-weight: 800;
        }

        .banner-item p {
            margin: 0;
            font-size: 14px;
            color: #5E5653;
            font-weight: 300;
        }

        /* FAB Button Styles */
        .fab-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 16px;
            z-index: 1000;
            width: 90%;
            max-width: 600px;
            padding: 0 20px;
            box-sizing: border-box;
        }

        .fab {
            flex: 1;
            padding: 16px 24px;
            border-radius: 12px;
            font-family: 'Work Sans', sans-serif;
            font-size: 1.25em;
            font-weight: 500;
            text-decoration: none;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: transform 0.25s ease, box-shadow 0.25s ease;
            cursor: pointer;
            border: none;
            -webkit-tap-highlight-color: transparent;
            /* Added for vertical centering */
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 52px;
        }

        .fab:active {
            transform: scale(0.95);
        }

        .fab-primary {
            background-color: #E75757;
            color: white;
        }

        .fab-secondary {
            background-color: #F0F0F0;
            color: #47403E;
        }

        @media (hover: hover) {
            .fab:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 16px rgba(0,0,0,0.2);
            }
        }

        /* Loading Styles */
        #loadingOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #ff6b6b;
            border-top: 5px solid #f5f5f5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 736px) {
            body {
                font-size: 11pt;
                padding: 15px;
            }

            .banner {
                flex-direction: column;
            }

            .banner-item {
                padding: 10px 0;
                border-right: none;
                border-bottom: 1px solid #FFD6D6;
            }

            .banner-item:last-child {
                border-bottom: none;
            }

            .fab {
                font-size: 1.1em;
                padding: 14px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="content-wrapper">
        <div class="header">
            <img src="https://blendvertise.carrd.co/assets/images/image03.png?v=9ef200d0" alt="Blendvertise Logo" class="logo-image">
        </div>
        <h1>Here's your updated article</h1>
        <div class="stats" id="statsDescription">
            <!-- Description will be populated from Airtable -->
        </div>
        
        <div class="banner">
            <div class="banner-item">
                <h3>3,450 Ads Checked</h3>
                <p>We've searched all of the major affiliate networks to find the ads that will perform best in your content.</p>
            </div>
            <div class="banner-item">
                <h3>Automatic, always up to date</h3>
                <p>Install our Wordpress, Contentful or Wix plugin to get started. Your articles are updated daily.</p>
            </div>
            <div class="banner-item">
                <h3>You're in control</h3>
                <p>You choose which brands to advertise, ad topics and ad density.</p>
            </div>
        </div>
        
        <div id="article" class="content-box">
            <div id="articleContent"></div>
        </div>
    </div>

    <!-- FAB Buttons -->
    <div class="fab-container">
        <a href="#" class="fab fab-primary">Sign up now</a>
        <button onclick="tryAnother()" class="fab fab-secondary">Try another article</button>
    </div>

    <div id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.2/marked.min.js"></script>
    <script>
        const loadingOverlay = document.getElementById('loadingOverlay');
        const articleContent = document.getElementById('articleContent');
        const statsDescription = document.getElementById('statsDescription');

        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        function sanitizeHTML(str) {
            const temp = document.createElement('div');
            temp.textContent = str;
            return temp.innerHTML;
        }

        function tryAnother() {
            window.location.href = 'index.html';
        }

        // Get the record ID directly from the URL
        const recordId = getUrlParameter('recordId');

        if (recordId) {
            const airtableUrl = `https://api.airtable.com/v0/appebg5mTyr0n3IC2/tblT2UflSMRpwrBtW/${recordId}`;

            loadingOverlay.style.display = 'flex';

            fetch(airtableUrl, {
                headers: {
                    'Authorization': 'Bearer patNwUWSMcd150uoi.f61251b6451ad5b257df31a8be47c67e27adbeeb3cced79565ff3c331ff5f896'
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (data && data.fields) {
                    if (data.fields.description) {
                        // Parse markdown in description
                        statsDescription.innerHTML = marked.parse(data.fields.description);
                    } else {
                        statsDescription.textContent = 'Analysis complete';
                    }

                    if (data.fields.article) {
                        const sanitizedContent = sanitizeHTML(data.fields.article);
                        const formattedContent = sanitizedContent
                            .replace(/\n/g, '<br>')
                            .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>')
                            .replace(/&lt;span class="highlight"&gt;/g, '<span class="highlight">')
                            .replace(/&lt;\/span&gt;/g, '</span>');
                        articleContent.innerHTML = formattedContent;
                    }
                } else {
                    throw new Error('Invalid response format from Airtable');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                articleContent.textContent = 'Error fetching results. Please try again.';
                statsDescription.textContent = 'Error loading results';
            })
            .finally(() => {
                loadingOverlay.style.display = 'none';
            });
        } else {
            articleContent.textContent = 'No record ID provided. Please submit content from the main page.';
            statsDescription.textContent = 'Missing article ID';
        }
    </script>
</body>
</html>
