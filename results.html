<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blendvertise Results</title>
    <!-- Previous styles remain the same -->
</head>
<body>
    <div class="content-wrapper">
        <div class="header">
            <img src="https://blendvertise.carrd.co/assets/images/image03.png?v=9ef200d0" alt="Blendvertise Logo" class="logo-image">
        </div>
        <h1>Here's your updated article</h1>
        <div class="stats" id="statsDescription">
            <!-- Description will be inserted here by JavaScript -->
        </div>
        
        <!-- Rest of the HTML remains the same -->

        <script>
            const loadingOverlay = document.getElementById('loadingOverlay');
            const articleContent = document.getElementById('articleContent');
            const statsDescription = document.getElementById('statsDescription');

            function getUrlParameter(name) {
                name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
                var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
                var results = regex.exec(location.search);
                return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
            }

            function sanitizeHTML(str) {
                const temp = document.createElement('div');
                temp.textContent = str;
                return temp.innerHTML;
            }

            // Get the record ID directly from the URL
            const recordId = getUrlParameter('recordId');

            if (recordId) {
                const airtableUrl = `https://api.airtable.com/v0/appebg5mTyr0n3IC2/tblT2UflSMRpwrBtW/${recordId}`;

                loadingOverlay.style.display = 'flex';

                fetch(airtableUrl, {
                    headers: {
                        'Authorization': 'Bearer patNwUWSMcd150uoi.f61251b6451ad5b257df31a8be47c67e27adbeeb3cced79565ff3c331ff5f896'
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data && data.fields) {
                        // Update the description from Airtable
                        if (data.fields.description) {
                            statsDescription.textContent = data.fields.description;
                        } else {
                            statsDescription.textContent = 'Analysis complete';
                        }

                        if (data.fields.article) {
                            const sanitizedContent = sanitizeHTML(data.fields.article);
                            const formattedContent = sanitizedContent
                                .replace(/\n/g, '<br>')
                                .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>')
                                .replace(/&lt;span class="highlight"&gt;/g, '<span class="highlight">')
                                .replace(/&lt;\/span&gt;/g, '</span>');
                            articleContent.innerHTML = formattedContent;
                        }
                    } else {
                        throw new Error('Invalid response format from Airtable');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    articleContent.textContent = 'Error fetching results. Please try again.';
                    statsDescription.textContent = 'Error loading results';
                })
                .finally(() => {
                    loadingOverlay.style.display = 'none';
                });
            } else {
                articleContent.textContent = 'No record ID provided. Please submit content from the main page.';
                statsDescription.textContent = 'Missing article ID';
            }
        </script>
    </div>
</body>
</html>
